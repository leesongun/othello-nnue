language: shell
arch:
  - amd64
  - arm64
os: linux

env:
  global:
    - ZIG_DIR=$HOME/zig
  
jobs:
  fast_finish: true

before_install:
  - URL=$(wget -O - https://ziglang.org/download/index.json | jq -r '.master."'$(arch)'-linux".tarball' 2>&1)
  - wget $URL
  - mkdir "$ZIG_DIR"
  - tar xf $(basename $URL) -C "$ZIG_DIR"
  - mv $ZIG_DIR/$(basename -s .tar.xz $URL)/* $ZIG_DIR 
  - export PATH=$PATH:$ZIG_DIR

addons:
  apt:
    update: true
    packages:
    - jq


script:
  - ls "$ZIG_DIR"
  - zig build test
  - zig build bench
  - zig fmt --check **.zig
